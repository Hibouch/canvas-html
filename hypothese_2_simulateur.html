<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simulateur Chatbot - HypothÃ¨se 2 (Smartly)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    input[type="range"] {
      accent-color: #8b5cf6;
    }
  </style>
</head>
<body class="w-full min-h-screen bg-gradient-to-br from-slate-50 to-purple-50 p-6">
  <div class="max-w-7xl mx-auto">
    <!-- Header -->
    <div class="bg-white rounded-2xl shadow-xl p-6 mb-6">
      <div class="flex items-center justify-center gap-3">
        <svg class="w-10 h-10 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
        </svg>
        <div class="text-center">
          <h1 class="text-3xl font-bold text-gray-800">Simulateur Chatbot</h1>
          <p class="text-sm text-gray-600 mt-1">HypothÃ¨se 2 : Approche Fournisseur (Smartly - 15% taux d'interaction)</p>
        </div>
      </div>
    </div>

    <!-- StratÃ©gies P1 et P2 -->
    <div class="bg-white rounded-xl shadow-lg p-6 mb-6 border-2 border-purple-400">
      <h3 class="text-lg font-bold text-gray-800 mb-4">ðŸ“Š StratÃ©gies d'Interaction</h3>
      <div class="grid grid-cols-2 gap-6">
        <div class="bg-blue-50 p-4 rounded-lg border-2 border-blue-400">
          <h4 class="font-bold text-blue-800 mb-2">ðŸ“± P1 : Messages ModÃ©rÃ©s</h4>
          <div class="text-2xl font-bold text-blue-600">3 messages/jour</div>
          <div class="text-xs text-gray-600 mt-1">Par utilisateur interagissant</div>
        </div>
        <div class="bg-orange-50 p-4 rounded-lg border-2 border-orange-400">
          <h4 class="font-bold text-orange-800 mb-2">ðŸ’¬ P2 : Messages Intensifs</h4>
          <div class="text-2xl font-bold text-orange-600">5 messages/jour</div>
          <div class="text-xs text-gray-600 mt-1">Par utilisateur interagissant</div>
        </div>
      </div>
    </div>

    <!-- 4 colonnes canaux -->
    <div id="channels-grid" class="grid grid-cols-2 gap-6 mb-8"></div>

    <!-- RÃ©sumÃ© des totaux par scÃ©nario -->
    <div id="scenarios-summary" class="grid grid-cols-4 gap-4 mb-8"></div>

    <!-- Tableau des packs recommandÃ©s -->
    <div id="packs-table" class="bg-white rounded-xl shadow-lg overflow-hidden"></div>

  </div>

  <script>
    // DonnÃ©es rÃ©elles
    const channelsData = {
      portal: {
        name: 'www.tunisietelecom.tn',
        color: 'blue',
        maxUsers: 21237,
        minUsers: 6041
      },
      eshop: {
        name: 'eshop.tunisietelecom.tn',
        color: 'green',
        maxUsers: 2703,
        minUsers: 709
      },
      myTTWeb: {
        name: 'mytt.tunisietelecom.tn',
        color: 'indigo',
        maxUsers: 21843,
        minUsers: 3946
      },
      myTTApp: {
        name: 'My TT App',
        color: 'purple',
        maxUsers: 93613,
        minUsers: 38580
      }
    };

    const packs = [
      { name: 'SAAS 5K', messages: 5000, monthly: 500, yearly: 6000, bots: 5 },
      { name: 'SAAS 10K', messages: 10000, monthly: 735, yearly: 8820, bots: 10 },
      { name: 'SAAS 20K', messages: 20000, monthly: 1200, yearly: 14400, bots: 10 },
      { name: 'SAAS 30K', messages: 30000, monthly: 1645, yearly: 19740, bots: 20 },
      { name: 'SAAS 50K', messages: 50000, monthly: 2450, yearly: 29400, bots: 30 },
      { name: 'SAAS 100K', messages: 100000, monthly: 4500, yearly: 54000, bots: 50 },
      { name: 'SAAS 150K', messages: 150000, monthly: 5500, yearly: 66000, bots: 80 }
    ];

    const colorClasses = {
      green: { bg: 'bg-green-500', bgLight: 'bg-green-50', text: 'text-green-600' },
      blue: { bg: 'bg-blue-500', bgLight: 'bg-blue-50', text: 'text-blue-600' },
      indigo: { bg: 'bg-indigo-500', bgLight: 'bg-indigo-50', text: 'text-indigo-600' },
      purple: { bg: 'bg-purple-500', bgLight: 'bg-purple-50', text: 'text-purple-600' }
    };

    const INTERACTION_RATE = 0.15; // 15% des visiteurs
    const MESSAGES_P1 = 3; // P1: 3 messages/jour
    const MESSAGES_P2 = 5; // P2: 5 messages/jour

    function formatNumber(num) {
      if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
      if (num >= 1000) return (num / 1000).toFixed(0) + 'K';
      return Math.round(num).toString();
    }

    function calculateChannel(channelKey) {
      const channel = channelsData[channelKey];
      
      // Utilisateurs interagissants (15% des visiteurs)
      const minInteracting = Math.round(channel.minUsers * INTERACTION_RATE);
      const maxInteracting = Math.round(channel.maxUsers * INTERACTION_RATE);
      const avgInteracting = Math.round((channel.minUsers + 0.30 * (channel.maxUsers - channel.minUsers)) * INTERACTION_RATE);
      
      // P1: 3 messages/jour
      const p1Best = Math.round(minInteracting * MESSAGES_P1 * 30);
      const p1Avg = Math.round(avgInteracting * MESSAGES_P1 * 30);
      const p1Worst = Math.round(maxInteracting * MESSAGES_P1 * 30);
      
      // P2: 5 messages/jour
      const p2Best = Math.round(minInteracting * MESSAGES_P2 * 30);
      const p2Avg = Math.round(avgInteracting * MESSAGES_P2 * 30);
      const p2Worst = Math.round(maxInteracting * MESSAGES_P2 * 30);
      
      return { 
        channelKey, 
        name: channel.name,
        minUsers: channel.minUsers,
        maxUsers: channel.maxUsers,
        minInteracting,
        maxInteracting,
        avgInteracting,
        p1Best, p1Avg, p1Worst,
        p2Best, p2Avg, p2Worst
      };
    }

    function findOptimalPacksForVolume(targetMessages) {
      let bestSolution = null;
      let bestScore = Infinity;

      function tryPackCombination(packIndices) {
        const selectedPacks = packIndices.map(i => packs[i]);
        const totalCapacity = selectedPacks.reduce((sum, p) => sum + p.messages, 0);
        
        if (totalCapacity >= targetMessages) {
          const totalCost = selectedPacks.reduce((sum, p) => sum + p.monthly, 0);
          const utilization = (targetMessages / totalCapacity) * 100;
          const wastedCapacity = totalCapacity - targetMessages;
          
          const score = totalCost + (wastedCapacity * 0.001);
          
          if (utilization > 0 && score < bestScore) {
            bestScore = score;
            bestSolution = {
              packs: selectedPacks,
              totalCapacity,
              totalCost,
              utilization: utilization.toFixed(1),
              wastedCapacity
            };
          }
        }
      }

      function generateCombinations(start, current) {
        if (current.length > 0) {
          tryPackCombination(current);
        }
        
        if (current.length < 7) {
          for (let i = start; i < packs.length; i++) {
            generateCombinations(i + 1, [...current, i]);
          }
        }
      }

      generateCombinations(0, []);
      
      return bestSolution || { packs: [], totalCapacity: 0, totalCost: 0, utilization: 0 };
    }

    function calculateAll() {
      const channelResults = Object.keys(channelsData).map(key => calculateChannel(key));
      
      // P1 totals
      const p1BestTotal = channelResults.reduce((sum, ch) => sum + ch.p1Best, 0);
      const p1AvgTotal = channelResults.reduce((sum, ch) => sum + ch.p1Avg, 0);
      const p1WorstTotal = channelResults.reduce((sum, ch) => sum + ch.p1Worst, 0);
      
      // P2 totals
      const p2BestTotal = channelResults.reduce((sum, ch) => sum + ch.p2Best, 0);
      const p2AvgTotal = channelResults.reduce((sum, ch) => sum + ch.p2Avg, 0);
      const p2WorstTotal = channelResults.reduce((sum, ch) => sum + ch.p2Worst, 0);
      
      // Optimisations
      const optimizationP1Best = findOptimalPacksForVolume(p1BestTotal);
      const optimizationP1Avg = findOptimalPacksForVolume(p1AvgTotal);
      const optimizationP1Worst = findOptimalPacksForVolume(p1WorstTotal);
      
      const optimizationP2Best = findOptimalPacksForVolume(p2BestTotal);
      const optimizationP2Avg = findOptimalPacksForVolume(p2AvgTotal);
      const optimizationP2Worst = findOptimalPacksForVolume(p2WorstTotal);
      
      return { 
        channels: channelResults,
        p1BestTotal, p1AvgTotal, p1WorstTotal,
        p2BestTotal, p2AvgTotal, p2WorstTotal,
        optimizationP1Best, optimizationP1Avg, optimizationP1Worst,
        optimizationP2Best, optimizationP2Avg, optimizationP2Worst
      };
    }

    function updateUI() {
      const calculations = calculateAll();
      
      const channelsGrid = document.getElementById('channels-grid');
      channelsGrid.innerHTML = '';
      
      Object.keys(channelsData).forEach(channelKey => {
        const channel = channelsData[channelKey];
        const result = calculations.channels.find(ch => ch.channelKey === channelKey);
        const colors = colorClasses[channel.color];
        
        const channelDiv = document.createElement('div');
        channelDiv.className = 'bg-white rounded-xl shadow-lg overflow-hidden';
        channelDiv.innerHTML = `
          <div class="${colors.bg} p-4 text-white">
            <h2 class="text-lg font-bold">${channel.name}</h2>
          </div>

          <div class="p-5">
            <div class="mb-4 bg-purple-50 p-3 rounded border border-purple-200">
              <div class="text-xs text-purple-800 font-semibold mb-2">Taux d'interaction: 15%</div>
              <div class="text-xs text-purple-700">
                Min: ${formatNumber(result.minUsers)} Ã— 15% = ${formatNumber(result.minInteracting)} users<br>
                Avg: ${formatNumber(result.avgInteracting)} users<br>
                Max: ${formatNumber(result.maxUsers)} Ã— 15% = ${formatNumber(result.maxInteracting)} users
              </div>
            </div>

            <div class="grid grid-cols-2 gap-3">
              <!-- P1 -->
              <div class="border-2 border-blue-400 rounded-lg p-3">
                <div class="font-bold text-blue-800 text-sm mb-2">ðŸ“± P1 (3 msg/jour)</div>
                <div class="space-y-1 text-xs">
                  <div class="bg-green-50 p-2 rounded">
                    <div class="text-gray-600">Best</div>
                    <div class="font-bold text-green-600">${result.p1Best.toLocaleString()}</div>
                  </div>
                  <div class="bg-blue-50 p-2 rounded">
                    <div class="text-gray-600">Avg</div>
                    <div class="font-bold text-blue-600">${result.p1Avg.toLocaleString()}</div>
                  </div>
                  <div class="bg-red-50 p-2 rounded">
                    <div class="text-gray-600">Worst</div>
                    <div class="font-bold text-red-600">${result.p1Worst.toLocaleString()}</div>
                  </div>
                </div>
              </div>

              <!-- P2 -->
              <div class="border-2 border-orange-400 rounded-lg p-3">
                <div class="font-bold text-orange-800 text-sm mb-2">ðŸ’¬ P2 (5 msg/jour)</div>
                <div class="space-y-1 text-xs">
                  <div class="bg-green-50 p-2 rounded">
                    <div class="text-gray-600">Best</div>
                    <div class="font-bold text-green-600">${result.p2Best.toLocaleString()}</div>
                  </div>
                  <div class="bg-blue-50 p-2 rounded">
                    <div class="text-gray-600">Avg</div>
                    <div class="font-bold text-blue-600">${result.p2Avg.toLocaleString()}</div>
                  </div>
                  <div class="bg-red-50 p-2 rounded">
                    <div class="text-gray-600">Worst</div>
                    <div class="font-bold text-red-600">${result.p2Worst.toLocaleString()}</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        `;
        channelsGrid.appendChild(channelDiv);
      });

      // RÃ©sumÃ© des scÃ©narios
      const scenariosSummary = document.getElementById('scenarios-summary');
      scenariosSummary.innerHTML = `
        <div class="bg-blue-50 border-2 border-blue-400 rounded-lg p-4 text-center">
          <div class="text-xs text-blue-800 font-bold mb-2">P1 - Best Case ðŸŸ¢</div>
          <div class="text-2xl font-bold text-blue-600">${calculations.p1BestTotal.toLocaleString()}</div>
          <div class="text-xs text-gray-600">messages/mois</div>
        </div>
        <div class="bg-blue-50 border-2 border-blue-400 rounded-lg p-4 text-center">
          <div class="text-xs text-blue-800 font-bold mb-2">P1 - Adoption (30%) ðŸ”µ</div>
          <div class="text-2xl font-bold text-blue-600">${calculations.p1AvgTotal.toLocaleString()}</div>
          <div class="text-xs text-gray-600">messages/mois</div>
        </div>
        <div class="bg-blue-50 border-2 border-blue-400 rounded-lg p-4 text-center">
          <div class="text-xs text-blue-800 font-bold mb-2">P1 - Worst Case ðŸ”´</div>
          <div class="text-2xl font-bold text-blue-600">${calculations.p1WorstTotal.toLocaleString()}</div>
          <div class="text-xs text-gray-600">messages/mois</div>
        </div>
        <div class="bg-orange-50 border-2 border-orange-400 rounded-lg p-4 text-center">
          <div class="text-xs text-orange-800 font-bold mb-2">P2 - Best Case ðŸŸ¢</div>
          <div class="text-2xl font-bold text-orange-600">${calculations.p2BestTotal.toLocaleString()}</div>
          <div class="text-xs text-gray-600">messages/mois</div>
        </div>
        <div class="bg-orange-50 border-2 border-orange-400 rounded-lg p-4 text-center">
          <div class="text-xs text-orange-800 font-bold mb-2">P2 - Adoption (30%) ðŸ”µ</div>
          <div class="text-2xl font-bold text-orange-600">${calculations.p2AvgTotal.toLocaleString()}</div>
          <div class="text-xs text-gray-600">messages/mois</div>
        </div>
        <div class="bg-orange-50 border-2 border-orange-400 rounded-lg p-4 text-center">
          <div class="text-xs text-orange-800 font-bold mb-2">P2 - Worst Case ðŸ”´</div>
          <div class="text-2xl font-bold text-orange-600">${calculations.p2WorstTotal.toLocaleString()}</div>
          <div class="text-xs text-gray-600">messages/mois</div>
        </div>
      `;

      // Tableau des packs
      const packsTable = document.getElementById('packs-table');
      packsTable.innerHTML = `
        <div class="p-6">
          <h3 class="text-2xl font-bold text-gray-800 mb-6">ðŸ“¦ Packs Disponibles</h3>
          
          <div class="overflow-x-auto mb-8 bg-gray-50 rounded-lg">
            <table class="w-full text-sm border-collapse">
              <thead>
                <tr class="bg-gray-200 border-b border-gray-300">
                  <th class="px-4 py-3 text-left font-bold text-gray-800 border-r border-gray-300">Pack</th>
                  <th class="px-4 py-3 text-right font-bold text-gray-800 border-r border-gray-300">CapacitÃ©</th>
                  <th class="px-4 py-3 text-right font-bold text-gray-800 border-r border-gray-300">CoÃ»t Mensuel</th>
                  <th class="px-4 py-3 text-right font-bold text-gray-800 border-r border-gray-300">CoÃ»t Annuel</th>
                  <th class="px-4 py-3 text-right font-bold text-gray-800">Bots</th>
                </tr>
              </thead>
              <tbody>
                ${packs.map((pack, idx) => `
                  <tr class="border-b border-gray-300 ${idx % 2 === 0 ? 'bg-white' : 'bg-gray-100'} hover:bg-blue-50 transition">
                    <td class="px-4 py-3 font-semibold text-gray-800 border-r border-gray-300">${pack.name}</td>
                    <td class="px-4 py-3 text-right text-gray-700 border-r border-gray-300">${pack.messages.toLocaleString()} msg</td>
                    <td class="px-4 py-3 text-right font-semibold text-blue-600 border-r border-gray-300">${pack.monthly}â‚¬</td>
                    <td class="px-4 py-3 text-right text-gray-700 border-r border-gray-300">${pack.yearly}â‚¬</td>
                    <td class="px-4 py-3 text-right text-gray-700">${pack.bots}</td>
                  </tr>
                `).join('')}
              </tbody>
            </table>
          </div>

          <div class="space-y-6">
            <!-- P1 Scenarios -->
            <div class="bg-blue-50 border-2 border-blue-400 rounded-lg p-6">
              <h4 class="font-bold text-blue-800 mb-4 text-lg">ðŸ“± P1 (3 messages/jour)</h4>
              <div class="grid grid-cols-3 gap-4">
                <div class="bg-white p-4 rounded border border-blue-200">
                  <div class="text-xs text-gray-600 font-semibold mb-2">Best Case ðŸŸ¢</div>
                  <div class="text-lg font-bold text-blue-600 mb-2">${calculations.p1BestTotal.toLocaleString()} msg</div>
                  <div class="text-xs text-gray-600 mb-3">CoÃ»t: <span class="font-bold">${calculations.optimizationP1Best.totalCost}â‚¬/mois</span></div>
                  <div class="text-xs bg-blue-50 p-2 rounded">Packs: <span class="font-bold">${calculations.optimizationP1Best.packs.map(p => p.name).join(' + ') || 'N/A'}</span></div>
                </div>
                <div class="bg-white p-4 rounded border border-blue-200">
                  <div class="text-xs text-gray-600 font-semibold mb-2">Adoption (30%) ðŸ”µ</div>
                  <div class="text-lg font-bold text-blue-600 mb-2">${calculations.p1AvgTotal.toLocaleString()} msg</div>
                  <div class="text-xs text-gray-600 mb-3">CoÃ»t: <span class="font-bold">${calculations.optimizationP1Avg.totalCost}â‚¬/mois</span></div>
                  <div class="text-xs bg-blue-50 p-2 rounded">Packs: <span class="font-bold">${calculations.optimizationP1Avg.packs.map(p => p.name).join(' + ') || 'N/A'}</span></div>
                </div>
                <div class="bg-white p-4 rounded border border-blue-200">
                  <div class="text-xs text-gray-600 font-semibold mb-2">Worst Case ðŸ”´</div>
                  <div class="text-lg font-bold text-blue-600 mb-2">${calculations.p1WorstTotal.toLocaleString()} msg</div>
                  <div class="text-xs text-gray-600 mb-3">CoÃ»t: <span class="font-bold">${calculations.optimizationP1Worst.totalCost}â‚¬/mois</span></div>
                  <div class="text-xs bg-blue-50 p-2 rounded">Packs: <span class="font-bold">${calculations.optimizationP1Worst.packs.map(p => p.name).join(' + ') || 'N/A'}</span></div>
                </div>
              </div>
            </div>

            <!-- P2 Scenarios -->
            <div class="bg-orange-50 border-2 border-orange-400 rounded-lg p-6">
              <h4 class="font-bold text-orange-800 mb-4 text-lg">ðŸ’¬ P2 (5 messages/jour)</h4>
              <div class="grid grid-cols-3 gap-4">
                <div class="bg-white p-4 rounded border border-orange-200">
                  <div class="text-xs text-gray-600 font-semibold mb-2">Best Case ðŸŸ¢</div>
                  <div class="text-lg font-bold text-orange-600 mb-2">${calculations.p2BestTotal.toLocaleString()} msg</div>
                  <div class="text-xs text-gray-600 mb-3">CoÃ»t: <span class="font-bold">${calculations.optimizationP2Best.totalCost}â‚¬/mois</span></div>
                  <div class="text-xs bg-orange-50 p-2 rounded">Packs: <span class="font-bold">${calculations.optimizationP2Best.packs.map(p => p.name).join(' + ') || 'N/A'}</span></div>
                </div>
                <div class="bg-white p-4 rounded border border-orange-200">
                  <div class="text-xs text-gray-600 font-semibold mb-2">Adoption (30%) ðŸ”µ</div>
                  <div class="text-lg font-bold text-orange-600 mb-2">${calculations.p2AvgTotal.toLocaleString()} msg</div>
                  <div class="text-xs text-gray-600 mb-3">CoÃ»t: <span class="font-bold">${calculations.optimizationP2Avg.totalCost}â‚¬/mois</span></div>
                  <div class="text-xs bg-orange-50 p-2 rounded">Packs: <span class="font-bold">${calculations.optimizationP2Avg.packs.map(p => p.name).join(' + ') || 'N/A'}</span></div>
                </div>
                <div class="bg-white p-4 rounded border border-orange-200">
                  <div class="text-xs text-gray-600 font-semibold mb-2">Worst Case ðŸ”´</div>
                  <div class="text-lg font-bold text-orange-600 mb-2">${calculations.p2WorstTotal.toLocaleString()} msg</div>
                  <div class="text-xs text-gray-600 mb-3">CoÃ»t: <span class="font-bold">${calculations.optimizationP2Worst.totalCost}â‚¬/mois</span></div>
                  <div class="text-xs bg-orange-50 p-2 rounded">Packs: <span class="font-bold">${calculations.optimizationP2Worst.packs.map(p => p.name).join(' + ') || 'N/A'}</span></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    updateUI();
  </script>
</body>
</html>
