<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simulateur Chatbot - Optimisation</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    input[type="range"] {
      accent-color: #8b5cf6;
    }
  </style>
</head>
<body class="w-full min-h-screen bg-gradient-to-br from-slate-50 to-purple-50 p-6">
  <div class="max-w-7xl mx-auto">
    <!-- Header -->
    <div class="bg-white rounded-2xl shadow-xl p-6 mb-6">
      <div class="flex items-center justify-center gap-3">
        <svg class="w-10 h-10 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
        </svg>
        <div class="text-center">
          <h1 class="text-3xl font-bold text-gray-800">Simulateur Chatbot</h1>
          <p class="text-sm text-gray-600 mt-1">Best Case | Adoption Progressive | Worst Case</p>
        </div>
      </div>
    </div>

    <!-- 4 colonnes canaux -->
    <div id="channels-grid" class="grid grid-cols-2 gap-6 mb-8"></div>

    <!-- Total Messages -->
    <div class="grid grid-cols-3 gap-4 mb-8">
      <div class="bg-green-50 rounded-xl shadow-lg p-6 border-2 border-green-400 text-center">
        <h3 class="text-lg font-bold text-green-800 mb-2">Best Case ðŸŸ¢</h3>
        <div id="total-best-case" class="text-4xl font-bold text-green-600">0</div>
        <div class="text-sm text-gray-600 mt-1">messages par mois</div>
      </div>
      
      <div class="bg-blue-50 rounded-xl shadow-lg p-6 border-2 border-blue-400 text-center">
        <h3 class="text-lg font-bold text-blue-800 mb-2">Adoption Progressive ðŸ”µ</h3>
        <div id="total-adoption-case" class="text-4xl font-bold text-blue-600">0</div>
        <div class="text-sm text-gray-600 mt-1">messages par mois</div>
      </div>
      
      <div class="bg-red-50 rounded-xl shadow-lg p-6 border-2 border-red-400 text-center">
        <h3 class="text-lg font-bold text-red-800 mb-2">Worst Case ðŸ”´</h3>
        <div id="total-worst-case" class="text-4xl font-bold text-red-600">0</div>
        <div class="text-sm text-gray-600 mt-1">messages par mois</div>
      </div>
    </div>

    <!-- Tableau des packs recommandÃ©s -->
    <div id="packs-table" class="bg-white rounded-xl shadow-lg overflow-hidden"></div>

  </div>

  <script>
    // Ã‰tat
    let messagesPerUser = {
      portal: 1,
      eshop: 1,
      myTTWeb: 2,
      myTTApp: 2
    };

    // DonnÃ©es rÃ©elles
    const channelsData = {
      portal: {
        name: 'www.tunisietelecom.tn',
        color: 'blue',
        maxUsers: 21237,
        minUsers: 6041
      },
      eshop: {
        name: 'eshop.tunisietelecom.tn',
        color: 'green',
        maxUsers: 2703,
        minUsers: 709
      },
      myTTWeb: {
        name: 'mytt.tunisietelecom.tn',
        color: 'indigo',
        maxUsers: 21843,
        minUsers: 3946
      },
      myTTApp: {
        name: 'My TT App',
        color: 'purple',
        maxUsers: 93613,
        minUsers: 38580
      }
    };

    const packs = [
      { name: 'SAAS 5K', messages: 5000, monthly: 500, yearly: 6000, bots: 5 },
      { name: 'SAAS 10K', messages: 10000, monthly: 735, yearly: 8820, bots: 10 },
      { name: 'SAAS 20K', messages: 20000, monthly: 1200, yearly: 14400, bots: 10 },
      { name: 'SAAS 30K', messages: 30000, monthly: 1645, yearly: 19740, bots: 20 },
      { name: 'SAAS 50K', messages: 50000, monthly: 2450, yearly: 29400, bots: 30 },
      { name: 'SAAS 100K', messages: 100000, monthly: 4500, yearly: 54000, bots: 50 },
      { name: 'SAAS 150K', messages: 150000, monthly: 5500, yearly: 66000, bots: 80 }
    ];

    const colorClasses = {
      green: { bg: 'bg-green-500', bgLight: 'bg-green-50', text: 'text-green-600' },
      blue: { bg: 'bg-blue-500', bgLight: 'bg-blue-50', text: 'text-blue-600' },
      indigo: { bg: 'bg-indigo-500', bgLight: 'bg-indigo-50', text: 'text-indigo-600' },
      purple: { bg: 'bg-purple-500', bgLight: 'bg-purple-50', text: 'text-purple-600' }
    };

    function formatNumber(num) {
      if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
      if (num >= 1000) return (num / 1000).toFixed(0) + 'K';
      return Math.round(num).toString();
    }

    function calculateChannel(channelKey) {
      const channel = channelsData[channelKey];
      const msgPerUserPerDay = messagesPerUser[channelKey];
      
      const bestCase = Math.round(channel.minUsers * msgPerUserPerDay * 30);
      
      // Adoption Progressive: Min + 30% Ã— (Max - Min)
      const adoptionUsers = Math.round(channel.minUsers + 0.30 * (channel.maxUsers - channel.minUsers));
      const adoptionCase = Math.round(adoptionUsers * msgPerUserPerDay * 30);
      
      const worstCase = Math.round(channel.maxUsers * msgPerUserPerDay * 30);
      
      return { 
        channelKey, 
        name: channel.name, 
        bestCase,
        adoptionCase,
        worstCase,
        adoptionUsers,
        msgPerDay: msgPerUserPerDay,
        minUsers: channel.minUsers,
        maxUsers: channel.maxUsers
      };
    }

    function findOptimalPacksForVolume(targetMessages) {
      let bestSolution = null;
      let bestScore = Infinity;

      // Tester toutes les combinaisons possibles de packs
      function tryPackCombination(packIndices) {
        const selectedPacks = packIndices.map(i => packs[i]);
        const totalCapacity = selectedPacks.reduce((sum, p) => sum + p.messages, 0);
        
        // VÃ©rifier que l'utilisation ne dÃ©passe pas 100%
        if (totalCapacity >= targetMessages) {
          const totalCost = selectedPacks.reduce((sum, p) => sum + p.monthly, 0);
          const utilization = (targetMessages / totalCapacity) * 100;
          const wastedCapacity = totalCapacity - targetMessages;
          
          // Score: favoriser l'utilisation Ã©levÃ©e et le coÃ»t bas
          const score = totalCost + (wastedCapacity * 0.001);
          
          if (utilization > 0 && score < bestScore) {
            bestScore = score;
            bestSolution = {
              packs: selectedPacks,
              packIndices: packIndices,
              totalCapacity,
              totalCost,
              utilization: utilization.toFixed(1),
              wastedCapacity,
              totalMessages: targetMessages
            };
          }
        }
      }

      // GÃ©nÃ©rer toutes les combinaisons possibles de 1 Ã  7 packs
      function generateCombinations(start, current) {
        if (current.length > 0) {
          tryPackCombination(current);
        }
        
        if (current.length < 7) {
          for (let i = start; i < packs.length; i++) {
            generateCombinations(i + 1, [...current, i]);
          }
        }
      }

      generateCombinations(0, []);
      
      return bestSolution;
    }

    function calculateAll() {
      const channelResults = Object.keys(channelsData).map(key => calculateChannel(key));
      
      const totalBestCase = channelResults.reduce((sum, ch) => sum + ch.bestCase, 0);
      const totalAdoptionCase = channelResults.reduce((sum, ch) => sum + ch.adoptionCase, 0);
      const totalWorstCase = channelResults.reduce((sum, ch) => sum + ch.worstCase, 0);

      // Optimisations pour chaque scÃ©nario
      const optimizationBest = findOptimalPacksForVolume(totalBestCase);
      const optimizationAdoption = findOptimalPacksForVolume(totalAdoptionCase);
      const optimizationWorst = findOptimalPacksForVolume(totalWorstCase);

      return { 
        channels: channelResults, 
        totalBestCase,
        totalAdoptionCase,
        totalWorstCase,
        optimizationBest,
        optimizationAdoption,
        optimizationWorst
      };
    }

    function updateUI() {
      const calculations = calculateAll();
      
      const channelsGrid = document.getElementById('channels-grid');
      channelsGrid.innerHTML = '';
      
      Object.keys(channelsData).forEach(channelKey => {
        const channel = channelsData[channelKey];
        const result = calculations.channels.find(ch => ch.channelKey === channelKey);
        const colors = colorClasses[channel.color];
        
        const channelDiv = document.createElement('div');
        channelDiv.className = 'bg-white rounded-xl shadow-lg overflow-hidden';
        channelDiv.innerHTML = `
          <div class="${colors.bg} p-4 text-white">
            <h2 class="text-lg font-bold">${channel.name}</h2>
          </div>

          <div class="p-5">
            <div class="mb-4">
              <div class="text-center mb-3">
                <div class="text-3xl font-bold text-gray-800">${messagesPerUser[channelKey]}</div>
                <div class="text-xs text-gray-500">messages/utilisateur/jour</div>
              </div>
              
              <input
                type="range"
                min="1"
                max="10"
                step="1"
                value="${messagesPerUser[channelKey]}"
                class="w-full h-2 bg-gray-200 rounded-lg cursor-pointer"
                onchange="updateMessagesPerUser('${channelKey}', parseInt(this.value))"
              />
            </div>

            <div class="grid grid-cols-2 gap-2 text-xs text-gray-600">
              <div>Min: ${formatNumber(channel.minUsers)} users/jour</div>
              <div>Max: ${formatNumber(channel.maxUsers)} users/jour</div>
            </div>
            
            <div class="bg-blue-50 p-2 rounded text-xs mt-2 border border-blue-200">
              <div class="text-blue-800 font-semibold mb-1">Adoption (30%):</div>
              <div class="text-blue-700">
                ${formatNumber(channel.minUsers)} + 30% Ã— (${formatNumber(channel.maxUsers)} - ${formatNumber(channel.minUsers)}) = ${formatNumber(result.adoptionUsers)}
              </div>
            </div>

            <div class="mt-4 space-y-2 text-sm">
              <div class="bg-green-50 p-3 rounded">
                <div class="font-semibold text-green-800">ðŸŸ¢ Best</div>
                <div class="text-lg font-bold text-green-600">${result.bestCase.toLocaleString()}</div>
              </div>
              <div class="bg-blue-50 p-3 rounded">
                <div class="font-semibold text-blue-800">ðŸ”µ Adoption</div>
                <div class="text-lg font-bold text-blue-600">${result.adoptionCase.toLocaleString()}</div>
              </div>
              <div class="bg-red-50 p-3 rounded">
                <div class="font-semibold text-red-800">ðŸ”´ Worst</div>
                <div class="text-lg font-bold text-red-600">${result.worstCase.toLocaleString()}</div>
              </div>
            </div>
          </div>
        `;
        channelsGrid.appendChild(channelDiv);
      });

      // Update totals
      document.getElementById('total-best-case').textContent = calculations.totalBestCase.toLocaleString();
      document.getElementById('total-adoption-case').textContent = calculations.totalAdoptionCase.toLocaleString();
      document.getElementById('total-worst-case').textContent = calculations.totalWorstCase.toLocaleString();

      // Create packs table with optimizations
      const packsTable = document.getElementById('packs-table');
      packsTable.innerHTML = `
        <div class="p-6">
          <h3 class="text-2xl font-bold text-gray-800 mb-6">ðŸ“¦ Packs Disponibles</h3>
          
          <div class="overflow-x-auto mb-8 bg-gray-50 rounded-lg">
            <table class="w-full text-sm border-collapse">
              <thead>
                <tr class="bg-gray-200 border-b border-gray-300">
                  <th class="px-4 py-3 text-left font-bold text-gray-800 border-r border-gray-300">Pack</th>
                  <th class="px-4 py-3 text-right font-bold text-gray-800 border-r border-gray-300">CapacitÃ©</th>
                  <th class="px-4 py-3 text-right font-bold text-gray-800 border-r border-gray-300">CoÃ»t Mensuel</th>
                  <th class="px-4 py-3 text-right font-bold text-gray-800 border-r border-gray-300">CoÃ»t Annuel</th>
                  <th class="px-4 py-3 text-right font-bold text-gray-800">Bots</th>
                </tr>
              </thead>
              <tbody>
                ${packs.map((pack, idx) => `
                  <tr class="border-b border-gray-300 ${idx % 2 === 0 ? 'bg-white' : 'bg-gray-100'} hover:bg-blue-50 transition">
                    <td class="px-4 py-3 font-semibold text-gray-800 border-r border-gray-300">${pack.name}</td>
                    <td class="px-4 py-3 text-right text-gray-700 border-r border-gray-300">${pack.messages.toLocaleString()} msg</td>
                    <td class="px-4 py-3 text-right font-semibold text-blue-600 border-r border-gray-300">${pack.monthly}â‚¬</td>
                    <td class="px-4 py-3 text-right text-gray-700 border-r border-gray-300">${pack.yearly}â‚¬</td>
                    <td class="px-4 py-3 text-right text-gray-700">${pack.bots}</td>
                  </tr>
                `).join('')}
              </tbody>
            </table>
          </div>

          <div class="space-y-6">
            <!-- Best Case -->
            <div class="bg-green-50 border-2 border-green-400 rounded-lg p-6">
              <h4 class="font-bold text-green-800 mb-4 text-lg">ðŸŸ¢ Best Case</h4>
              <div class="grid grid-cols-4 gap-4 text-sm">
                <div>
                  <div class="text-gray-600 text-xs">Volume Ã  couvrir</div>
                  <div class="font-bold text-green-600 text-lg">${calculations.totalBestCase.toLocaleString()}</div>
                  <div class="text-gray-500 text-xs">messages/mois</div>
                </div>
                <div>
                  <div class="text-gray-600 text-xs">CoÃ»t mensuel</div>
                  <div class="font-bold text-green-600 text-lg">${calculations.optimizationBest.totalCost}â‚¬</div>
                </div>
                <div>
                  <div class="text-gray-600 text-xs">CoÃ»t annuel</div>
                  <div class="font-bold text-green-600 text-lg">${(calculations.optimizationBest.totalCost * 12).toLocaleString()}â‚¬</div>
                </div>
                <div>
                  <div class="text-gray-600 text-xs">Packs recommandÃ©s</div>
                  <div class="font-bold text-green-600">${calculations.optimizationBest.packs.map(p => p.name).join(' + ')}</div>
                </div>
              </div>
            </div>

            <!-- Adoption Progressive -->
            <div class="bg-blue-50 border-2 border-blue-400 rounded-lg p-6">
              <h4 class="font-bold text-blue-800 mb-4 text-lg">ðŸ”µ Adoption Progressive (30%)</h4>
              <div class="grid grid-cols-4 gap-4 text-sm">
                <div>
                  <div class="text-gray-600 text-xs">Volume Ã  couvrir</div>
                  <div class="font-bold text-blue-600 text-lg">${calculations.totalAdoptionCase.toLocaleString()}</div>
                  <div class="text-gray-500 text-xs">messages/mois</div>
                </div>
                <div>
                  <div class="text-gray-600 text-xs">CoÃ»t mensuel</div>
                  <div class="font-bold text-blue-600 text-lg">${calculations.optimizationAdoption.totalCost}â‚¬</div>
                </div>
                <div>
                  <div class="text-gray-600 text-xs">CoÃ»t annuel</div>
                  <div class="font-bold text-blue-600 text-lg">${(calculations.optimizationAdoption.totalCost * 12).toLocaleString()}â‚¬</div>
                </div>
                <div>
                  <div class="text-gray-600 text-xs">Packs recommandÃ©s</div>
                  <div class="font-bold text-blue-600">${calculations.optimizationAdoption.packs.map(p => p.name).join(' + ')}</div>
                </div>
              </div>
            </div>

            <!-- Worst Case -->
            <div class="bg-red-50 border-2 border-red-400 rounded-lg p-6">
              <h4 class="font-bold text-red-800 mb-4 text-lg">ðŸ”´ Worst Case</h4>
              <div class="grid grid-cols-4 gap-4 text-sm">
                <div>
                  <div class="text-gray-600 text-xs">Volume Ã  couvrir</div>
                  <div class="font-bold text-red-600 text-lg">${calculations.totalWorstCase.toLocaleString()}</div>
                  <div class="text-gray-500 text-xs">messages/mois</div>
                </div>
                <div>
                  <div class="text-gray-600 text-xs">CoÃ»t mensuel</div>
                  <div class="font-bold text-red-600 text-lg">${calculations.optimizationWorst.totalCost}â‚¬</div>
                </div>
                <div>
                  <div class="text-gray-600 text-xs">CoÃ»t annuel</div>
                  <div class="font-bold text-red-600 text-lg">${(calculations.optimizationWorst.totalCost * 12).toLocaleString()}â‚¬</div>
                </div>
                <div>
                  <div class="text-gray-600 text-xs">Packs recommandÃ©s</div>
                  <div class="font-bold text-red-600">${calculations.optimizationWorst.packs.map(p => p.name).join(' + ')}</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function updateMessagesPerUser(channelKey, value) {
      messagesPerUser[channelKey] = value;
      updateUI();
    }

    updateUI();
  </script>
</body>
</html>
