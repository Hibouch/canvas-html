<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Approche spÃ©cialement conÃ§ue pour les pages d'assistance</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    input[type="range"] {
      accent-color: #8b5cf6;
    }
  </style>
</head>
<body class="w-full min-h-screen bg-gradient-to-br from-slate-50 to-purple-50 p-6">
  <div class="max-w-7xl mx-auto">
    <!-- Header -->
    <div class="bg-white rounded-2xl shadow-xl p-6 mb-6">
      <div class="flex items-center justify-center gap-3">
        <svg class="w-10 h-10 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
        </svg>
        <div class="text-center">
          <h1 class="text-3xl font-bold text-gray-800">Simulateur Chatbot</h1>
          <p class="text-sm text-gray-600 mt-1">BasÃ© sur les sessions rÃ©elles mensuelles</p>
        </div>
      </div>
    </div>

    <!-- 3 colonnes canaux avec donnÃ©es rÃ©elles -->
    <div id="channels-grid" class="grid grid-cols-3 gap-6 mb-8"></div>

    <!-- Total Messages -->
    <div class="grid grid-cols-3 gap-4 mb-8">
      <div class="bg-green-50 rounded-xl shadow-lg p-6 border-2 border-green-400 text-center">
        <h3 class="text-lg font-bold text-green-800 mb-2">Best Case ðŸŸ¢</h3>
        <div id="total-best-case" class="text-4xl font-bold text-green-600">0</div>
        <div class="text-sm text-gray-600 mt-1">messages par mois</div>
      </div>
      
      <div class="bg-blue-50 rounded-xl shadow-lg p-6 border-2 border-blue-400 text-center">
        <h3 class="text-lg font-bold text-blue-800 mb-2">Adoption Progressive ðŸ”µ</h3>
        <div id="total-adoption-case" class="text-4xl font-bold text-blue-600">0</div>
        <div class="text-sm text-gray-600 mt-1">messages par mois</div>
      </div>
      
      <div class="bg-red-50 rounded-xl shadow-lg p-6 border-2 border-red-400 text-center">
        <h3 class="text-lg font-bold text-red-800 mb-2">Worst Case ðŸ”´</h3>
        <div id="total-worst-case" class="text-4xl font-bold text-red-600">0</div>
        <div class="text-sm text-gray-600 mt-1">messages par mois</div>
      </div>
    </div>

    <!-- Tableau des packs recommandÃ©s -->
    <div id="packs-table" class="bg-white rounded-xl shadow-lg overflow-hidden"></div>

  </div>

  <script>
    // Ã‰tat: questions par session pour chaque canal
    let questionsPerSession = {
      myTTWeb: 3,
      myTTApp: 3,
      eshop: 3
    };

    // DonnÃ©es rÃ©elles basÃ©es sur les sessions mensuelles
    const channelsData = {
      myTTWeb: {
        name: 'mytt.tunisietelecom.tn',
        color: 'indigo',
        pages: [
          { name: 'Renseignements (Auth)', sessions: 138 },
          { name: 'RÃ©clamations (Auth)', sessions: 369 },
          { name: 'RÃ©clamations (Anon)', sessions: 21084 }
        ],
        totalSessions: 21591, // 138 + 369 + 21084
        adoptionRate: 0.30 // 30%
      },
      myTTApp: {
        name: 'My TT App',
        color: 'purple',
        pages: [
          { name: '/contactFormScreen (Anon)', sessions: 91575 },
          { name: '/reclamationMenu (Auth)', sessions: 101358 }
        ],
        totalSessions: 192933,
        adoptionRate: 0.30
      },
      eshop: {
        name: 'eshop.tunisietelecom.tn',
        color: 'green',
        pages: [
          { name: '/nous-contacter', sessions: 705 },
          { name: '/anonymos', sessions: 1 }
        ],
        totalSessions: 706,
        adoptionRate: 0.30
      }
    };

    const packs = [
      { name: 'SAAS 5K', messages: 5000, monthly: 500, yearly: 6000, bots: 5 },
      { name: 'SAAS 10K', messages: 10000, monthly: 735, yearly: 8820, bots: 10 },
      { name: 'SAAS 20K', messages: 20000, monthly: 1200, yearly: 14400, bots: 10 },
      { name: 'SAAS 30K', messages: 30000, monthly: 1645, yearly: 19740, bots: 20 },
      { name: 'SAAS 50K', messages: 50000, monthly: 2450, yearly: 29400, bots: 30 },
      { name: 'SAAS 100K', messages: 100000, monthly: 4500, yearly: 54000, bots: 50 },
      { name: 'SAAS 150K', messages: 150000, monthly: 5500, yearly: 66000, bots: 80 }
    ];

    const colorClasses = {
      green: { bg: 'bg-green-500', bgLight: 'bg-green-50', text: 'text-green-600', border: 'border-green-400' },
      blue: { bg: 'bg-blue-500', bgLight: 'bg-blue-50', text: 'text-blue-600', border: 'border-blue-400' },
      indigo: { bg: 'bg-indigo-500', bgLight: 'bg-indigo-50', text: 'text-indigo-600', border: 'border-indigo-400' },
      purple: { bg: 'bg-purple-500', bgLight: 'bg-purple-50', text: 'text-purple-600', border: 'border-purple-400' }
    };

    function formatNumber(num) {
      if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
      if (num >= 1000) return (num / 1000).toFixed(0) + 'K';
      return Math.round(num).toString();
    }

    function calculateChannel(channelKey) {
      const channel = channelsData[channelKey];
      const questionsPerSessionForChannel = questionsPerSession[channelKey];
      
      // Best Case: 10% des sessions mensuelles Ã— questions par session
      const bestCase = Math.round(channel.totalSessions * 0.10 * questionsPerSessionForChannel);
      
      // Adoption Progressive: 30% des sessions mensuelles Ã— questions par session
      const adoptionCase = Math.round(channel.totalSessions * channel.adoptionRate * questionsPerSessionForChannel);
      
      // Worst Case: 100% des sessions mensuelles Ã— questions par session
      const worstCase = Math.round(channel.totalSessions * 1.0 * questionsPerSessionForChannel);
      
      return { 
        channelKey, 
        name: channel.name,
        totalSessions: channel.totalSessions,
        pages: channel.pages,
        questionsPerSessionForChannel,
        bestCase,
        adoptionCase,
        worstCase
      };
    }

    function findOptimalPacksForVolume(targetMessages) {
      let bestSolution = null;
      let bestScore = Infinity;

      function tryPackCombination(packIndices) {
        const selectedPacks = packIndices.map(i => packs[i]);
        const totalCapacity = selectedPacks.reduce((sum, p) => sum + p.messages, 0);
        
        if (totalCapacity >= targetMessages) {
          const totalCost = selectedPacks.reduce((sum, p) => sum + p.monthly, 0);
          const utilization = (targetMessages / totalCapacity) * 100;
          const wastedCapacity = totalCapacity - targetMessages;
          
          const score = totalCost + (wastedCapacity * 0.001);
          
          if (utilization > 0 && score < bestScore) {
            bestScore = score;
            bestSolution = {
              packs: selectedPacks,
              packIndices: packIndices,
              totalCapacity,
              totalCost,
              utilization: utilization.toFixed(1),
              wastedCapacity,
              totalMessages: targetMessages
            };
          }
        }
      }

      function generateCombinations(start, current) {
        if (current.length > 0) {
          tryPackCombination(current);
        }
        
        if (current.length < 7) {
          for (let i = start; i < packs.length; i++) {
            generateCombinations(i + 1, [...current, i]);
          }
        }
      }

      generateCombinations(0, []);
      return bestSolution;
    }

    function calculateAll() {
      const channelResults = Object.keys(channelsData).map(key => calculateChannel(key));
      
      const totalBestCase = channelResults.reduce((sum, ch) => sum + ch.bestCase, 0);
      const totalAdoptionCase = channelResults.reduce((sum, ch) => sum + ch.adoptionCase, 0);
      const totalWorstCase = channelResults.reduce((sum, ch) => sum + ch.worstCase, 0);

      const optimizationBest = findOptimalPacksForVolume(totalBestCase);
      const optimizationAdoption = findOptimalPacksForVolume(totalAdoptionCase);
      const optimizationWorst = findOptimalPacksForVolume(totalWorstCase);

      return { 
        channels: channelResults, 
        totalBestCase,
        totalAdoptionCase,
        totalWorstCase,
        optimizationBest,
        optimizationAdoption,
        optimizationWorst
      };
    }

    function updateQuestionsPerSession(channelKey, value) {
      questionsPerSession[channelKey] = value;
      updateUI();
    }

    function updateUI() {
      const calculations = calculateAll();
      
      const channelsGrid = document.getElementById('channels-grid');
      channelsGrid.innerHTML = '';
      
      Object.keys(channelsData).forEach(channelKey => {
        const channel = channelsData[channelKey];
        const result = calculations.channels.find(ch => ch.channelKey === channelKey);
        const colors = colorClasses[channel.color];
        
        const channelDiv = document.createElement('div');
        channelDiv.className = `bg-white rounded-xl shadow-lg overflow-hidden border-2 ${colors.border}`;
        channelDiv.innerHTML = `
          <div class="${colors.bg} p-4 text-white">
            <h2 class="text-lg font-bold">${channel.name}</h2>
          </div>

          <div class="p-5">
            <!-- Questions par Session Slider -->
            <div class="mb-4 bg-gradient-to-r ${colors.bgLight} rounded-lg p-4 border ${colors.border}">
              <div class="text-center mb-3">
                <div class="text-3xl font-bold ${colors.text}">${questionsPerSession[channelKey]}</div>
                <div class="text-xs text-gray-600">questions par session</div>
              </div>
              <input
                type="range"
                min="1"
                max="5"
                step="1"
                value="${questionsPerSession[channelKey]}"
                class="w-full h-2 bg-gray-200 rounded-lg cursor-pointer"
                onchange="updateQuestionsPerSession('${channelKey}', parseInt(this.value))"
              />
              <div class="flex justify-between text-xs text-gray-500 mt-2">
                <span>1</span>
                <span>2</span>
                <span>3</span>
                <span>4</span>
                <span>5</span>
              </div>
            </div>

            <div class="mb-4 bg-gray-50 rounded-lg p-3">
              <div class="text-center mb-2">
                <div class="text-2xl font-bold text-gray-800">${channel.totalSessions.toLocaleString()}</div>
                <div class="text-xs text-gray-500">sessions mensuelles totales</div>
              </div>
              
              <div class="mt-3 space-y-1 text-xs">
                ${channel.pages.map(page => `
                  <div class="flex justify-between items-center py-1 px-2 hover:bg-white rounded">
                    <span class="text-gray-700 font-medium">${page.name}</span>
                    <span class="${colors.text} font-bold">${page.sessions.toLocaleString()}</span>
                  </div>
                `).join('')}
              </div>
            </div>

            <div class="${colors.bgLight} p-3 rounded-lg border ${colors.border} mb-4">
              <div class="text-xs text-gray-600 mb-1">Formule de calcul:</div>
              <div class="text-xs font-mono ${colors.text}">
                Sessions Ã— Taux adoption Ã— ${questionsPerSession[channelKey]} questions
              </div>
            </div>

            <div class="space-y-2 text-sm">
              <div class="bg-green-50 p-3 rounded border border-green-300">
                <div class="font-semibold text-green-800 text-xs mb-1">ðŸŸ¢ Best Case (10%)</div>
                <div class="text-lg font-bold text-green-600">${result.bestCase.toLocaleString()}</div>
                <div class="text-xs text-gray-500 mt-1">${formatNumber(result.totalSessions * 0.10)} sessions Ã— ${questionsPerSession[channelKey]}</div>
              </div>
              <div class="bg-blue-50 p-3 rounded border border-blue-300">
                <div class="font-semibold text-blue-800 text-xs mb-1">ðŸ”µ Adoption (30%)</div>
                <div class="text-lg font-bold text-blue-600">${result.adoptionCase.toLocaleString()}</div>
                <div class="text-xs text-gray-500 mt-1">${formatNumber(result.totalSessions * 0.30)} sessions Ã— ${questionsPerSession[channelKey]}</div>
              </div>
              <div class="bg-red-50 p-3 rounded border border-red-300">
                <div class="font-semibold text-red-800 text-xs mb-1">ðŸ”´ Worst Case (100%)</div>
                <div class="text-lg font-bold text-red-600">${result.worstCase.toLocaleString()}</div>
                <div class="text-xs text-gray-500 mt-1">${formatNumber(result.totalSessions)} sessions Ã— ${questionsPerSession[channelKey]}</div>
              </div>
            </div>
          </div>
        `;
        channelsGrid.appendChild(channelDiv);
      });

      // Update totals
      document.getElementById('total-best-case').textContent = calculations.totalBestCase.toLocaleString();
      document.getElementById('total-adoption-case').textContent = calculations.totalAdoptionCase.toLocaleString();
      document.getElementById('total-worst-case').textContent = calculations.totalWorstCase.toLocaleString();

      // Create packs table with optimizations
      const packsTable = document.getElementById('packs-table');
      packsTable.innerHTML = `
        <div class="p-6">
          <h3 class="text-2xl font-bold text-gray-800 mb-6">ðŸ“¦ Packs Disponibles & Recommandations</h3>
          
          <div class="overflow-x-auto mb-8 bg-gray-50 rounded-lg">
            <table class="w-full text-sm border-collapse">
              <thead>
                <tr class="bg-gray-200 border-b border-gray-300">
                  <th class="px-4 py-3 text-left font-bold text-gray-800 border-r border-gray-300">Pack</th>
                  <th class="px-4 py-3 text-right font-bold text-gray-800 border-r border-gray-300">CapacitÃ©</th>
                  <th class="px-4 py-3 text-right font-bold text-gray-800 border-r border-gray-300">CoÃ»t Mensuel</th>
                  <th class="px-4 py-3 text-right font-bold text-gray-800 border-r border-gray-300">CoÃ»t Annuel</th>
                  <th class="px-4 py-3 text-right font-bold text-gray-800">Bots</th>
                </tr>
              </thead>
              <tbody>
                ${packs.map((pack, idx) => `
                  <tr class="border-b border-gray-300 ${idx % 2 === 0 ? 'bg-white' : 'bg-gray-100'} hover:bg-blue-50 transition">
                    <td class="px-4 py-3 font-semibold text-gray-800 border-r border-gray-300">${pack.name}</td>
                    <td class="px-4 py-3 text-right text-gray-700 border-r border-gray-300">${pack.messages.toLocaleString()} msg</td>
                    <td class="px-4 py-3 text-right font-semibold text-blue-600 border-r border-gray-300">${pack.monthly}â‚¬</td>
                    <td class="px-4 py-3 text-right text-gray-700 border-r border-gray-300">${pack.yearly}â‚¬</td>
                    <td class="px-4 py-3 text-right text-gray-700">${pack.bots}</td>
                  </tr>
                `).join('')}
              </tbody>
            </table>
          </div>

          <div class="space-y-6">
            <!-- Best Case -->
            <div class="bg-green-50 border-2 border-green-400 rounded-lg p-6">
              <h4 class="font-bold text-green-800 mb-4 text-lg">ðŸŸ¢ Best Case (10% adoption)</h4>
              <div class="grid grid-cols-4 gap-4 text-sm">
                <div>
                  <div class="text-gray-600 text-xs">Volume Ã  couvrir</div>
                  <div class="font-bold text-green-600 text-lg">${calculations.totalBestCase.toLocaleString()}</div>
                  <div class="text-gray-500 text-xs">messages/mois</div>
                </div>
                <div>
                  <div class="text-gray-600 text-xs">CoÃ»t mensuel</div>
                  <div class="font-bold text-green-600 text-lg">${calculations.optimizationBest.totalCost}â‚¬</div>
                </div>
                <div>
                  <div class="text-gray-600 text-xs">CoÃ»t annuel</div>
                  <div class="font-bold text-green-600 text-lg">${(calculations.optimizationBest.totalCost * 12).toLocaleString()}â‚¬</div>
                </div>
                <div>
                  <div class="text-gray-600 text-xs">Packs recommandÃ©s</div>
                  <div class="font-bold text-green-600">${calculations.optimizationBest.packs.map(p => p.name).join(' + ')}</div>
                </div>
              </div>
              <div class="mt-3 text-xs text-gray-600 bg-white p-3 rounded">
                <strong>DÃ©tail:</strong> CapacitÃ© totale ${calculations.optimizationBest.totalCapacity.toLocaleString()} msg 
                | Utilisation ${calculations.optimizationBest.utilization}% 
                | ${calculations.optimizationBest.packs.reduce((sum, p) => sum + p.bots, 0)} bots disponibles
              </div>
            </div>

            <!-- Adoption Progressive -->
            <div class="bg-blue-50 border-2 border-blue-400 rounded-lg p-6">
              <h4 class="font-bold text-blue-800 mb-4 text-lg">ðŸ”µ Adoption Progressive (30%)</h4>
              <div class="grid grid-cols-4 gap-4 text-sm">
                <div>
                  <div class="text-gray-600 text-xs">Volume Ã  couvrir</div>
                  <div class="font-bold text-blue-600 text-lg">${calculations.totalAdoptionCase.toLocaleString()}</div>
                  <div class="text-gray-500 text-xs">messages/mois</div>
                </div>
                <div>
                  <div class="text-gray-600 text-xs">CoÃ»t mensuel</div>
                  <div class="font-bold text-blue-600 text-lg">${calculations.optimizationAdoption.totalCost}â‚¬</div>
                </div>
                <div>
                  <div class="text-gray-600 text-xs">CoÃ»t annuel</div>
                  <div class="font-bold text-blue-600 text-lg">${(calculations.optimizationAdoption.totalCost * 12).toLocaleString()}â‚¬</div>
                </div>
                <div>
                  <div class="text-gray-600 text-xs">Packs recommandÃ©s</div>
                  <div class="font-bold text-blue-600">${calculations.optimizationAdoption.packs.map(p => p.name).join(' + ')}</div>
                </div>
              </div>
              <div class="mt-3 text-xs text-gray-600 bg-white p-3 rounded">
                <strong>DÃ©tail:</strong> CapacitÃ© totale ${calculations.optimizationAdoption.totalCapacity.toLocaleString()} msg 
                | Utilisation ${calculations.optimizationAdoption.utilization}% 
                | ${calculations.optimizationAdoption.packs.reduce((sum, p) => sum + p.bots, 0)} bots disponibles
              </div>
            </div>

            <!-- Worst Case -->
            <div class="bg-red-50 border-2 border-red-400 rounded-lg p-6">
              <h4 class="font-bold text-red-800 mb-4 text-lg">ðŸ”´ Worst Case (100% adoption)</h4>
              <div class="grid grid-cols-4 gap-4 text-sm">
                <div>
                  <div class="text-gray-600 text-xs">Volume Ã  couvrir</div>
                  <div class="font-bold text-red-600 text-lg">${calculations.totalWorstCase.toLocaleString()}</div>
                  <div class="text-gray-500 text-xs">messages/mois</div>
                </div>
                <div>
                  <div class="text-gray-600 text-xs">CoÃ»t mensuel</div>
                  <div class="font-bold text-red-600 text-lg">${calculations.optimizationWorst.totalCost}â‚¬</div>
                </div>
                <div>
                  <div class="text-gray-600 text-xs">CoÃ»t annuel</div>
                  <div class="font-bold text-red-600 text-lg">${(calculations.optimizationWorst.totalCost * 12).toLocaleString()}â‚¬</div>
                </div>
                <div>
                  <div class="text-gray-600 text-xs">Packs recommandÃ©s</div>
                  <div class="font-bold text-red-600">${calculations.optimizationWorst.packs.map(p => p.name).join(' + ')}</div>
                </div>
              </div>
              <div class="mt-3 text-xs text-gray-600 bg-white p-3 rounded">
                <strong>DÃ©tail:</strong> CapacitÃ© totale ${calculations.optimizationWorst.totalCapacity.toLocaleString()} msg 
                | Utilisation ${calculations.optimizationWorst.utilization}% 
                | ${calculations.optimizationWorst.packs.reduce((sum, p) => sum + p.bots, 0)} bots disponibles
              </div>
            </div>
          </div>
        </div>
      `;
    }

    // Initialisation
    updateUI();
  </script>
</body>
</html>

